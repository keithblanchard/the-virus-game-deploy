!function(){"use strict";class e{static distance(e,t){const i=e.x-t.x,s=e.y-t.y;return Math.hypot(i,s)}constructor(e,t){this.x=parseFloat(e),this.y=parseFloat(t)}}class t{static intersects(t,i){return e.distance(t.center,i.center)<=t.radius+i.radius}constructor(t){this.radius=this.getRandomCircleRadius();let i=Math.random()*t;i<this.radius&&(i=this.radius+10);const s=t-this.radius;i>s&&(i=s-10),this.center=new e(i,10)}getRandomCircleRadius(){return Math.floor(50*Math.random())+50}contains(t){return e.distance(t,this.center)<=this.radius}}function i(){const e=localStorage.getItem("high-score");document.getElementById("high-score").innerHTML=e||"0"}var s={init:function(){document.getElementById("score").style.color="white",i()},initHighScore:i,setHighScore:function(e){const t=parseInt(localStorage.getItem("high-score")),i=t||0,s=parseInt(e);(s||0)>i&&localStorage.setItem("high-score",e)}};let n,o,r,c;function a(){r.src="../svg/speakerOn.svg"}function l(){r.src="../svg/speakerOff.svg"}var d={toggleAudio:function(){n.paused?(n.play(),a(),localStorage.setItem("disable-audio","no")):(n.pause(),l(),localStorage.setItem("disable-audio","yes"))},endGame:function(){n.pause(),n.currentTime=0},init:function(){"yes"===localStorage.getItem("disable-audio")?l():(n.currentTime=0,n.play(),a())},onLoad:function(){n=document.getElementById("sound"),o=document.getElementById("sound-toggle-button"),r=document.createElement("img"),o.appendChild(r),c=document.createElement("div"),o.appendChild(c),"yes"===localStorage.getItem("disable-audio")?l():a()}};const{setHighScore:h}=s;const u=["theVirus_blue","theVirus_ice","theVirus_purple2","theVirus_purpleCartoon","theVirus_red2","theVirus_red","theVirus_yellow"];var g={loadVirusImages:function(){const e=document.getElementById("viruses");let t=0;u.forEach(i=>{let s=document.createElement("img");s.srcset=`../svg-to-png/viruses/${i}-80w.png 80w,\n                         ../svg-to-png/viruses/${i}-100w.png 100w,\n                         ../svg-to-png/viruses/${i}-150w.png 150w`,s.sizes="(max-width: 400px) 80px,\n                       (max-width: 800px) 100px,\n                       (max-width: 1600px) 150px",s.id=`virus${t}`,e.appendChild(s),t++})}};let m;window.TheVirus=window.TheVirus||{},window.TheVirus.toggleAudio=d.toggleAudio,window.TheVirus.handleClick=function(){if(!m.gameOver){const t=new e(event.offsetX,event.offsetY);m.makeMove(t)}},window.TheVirus.onLoad=async function(){await async function(){const e=await fetch("./templates/root.html"),t=await e.text();document.body.insertAdjacentHTML("afterbegin",t)}(),g.loadVirusImages(),m=new class{constructor(){this.score=0,this.gameOver=!1}init(e){this.context=e.context,this.width=e.width,this.height=e.height,this.height=e.height,this.score=0,this.gameOver=!1,this.virusIndex=0,this.speed=1,this.level=1,this.createCircles(),this.tick(),this.setLevel(),document.getElementById("level-label").style.visibility="visible",this.updateSpeedInterval=setInterval(()=>{this.speed++,this.updateLevel()},6e4)}updateLevel(){this.level++,this.setLevel()}setLevel(){document.getElementById("level").innerText=this.level}createCircles(){this.circles=[],this.circles.push(new t(this.width)),this.addCircleInterval=setInterval(()=>{this.addCircle()},1e3)}endGame(){this.gameOver=!0,clearInterval(this.addCircleInterval),clearInterval(this.updateSpeedInterval),cancelAnimationFrame(this.requestAnimationInterval),document.getElementById("game-over").style.display="block",document.getElementById("controls").style.display="flex",document.getElementById("canvas").style.display="none",h(this.score),d.endGame()}tick(){this.requestAnimationInterval=window.requestAnimationFrame(()=>{this.animationLoop()})}addCircle(){let e=new t(this.width),i=!0;this.circles.forEach(s=>{t.intersects(s,e)&&(i=!1)}),i&&this.circles.push(e)}makeMove(e){let t=localStorage.getItem("high-score");t||(t=0),this.circles=this.circles.filter(t=>!t.contains(e)||(this.score+=1,setTimeout(()=>{this.addCircle()},1e3),!1));const i=document.getElementById("score");i.innerHTML=this.score,this.score>t&&(i.style.color="gold")}drawCircle(e){e.image||(e.image=document.getElementById(`virus${this.virusIndex}`),this.virusIndex++,this.virusIndex>6&&(this.virusIndex=0)),this.context.drawImage(e.image,e.center.x,e.center.y,e.radius,e.radius)}tickCircle(e){e.center.y+e.radius>=this.height&&this.endGame(),e.center.y+=this.speed}animationLoop(){this.context.clearRect(0,0,this.width,this.height),this.circles.forEach(e=>{this.tickCircle(e)}),this.circles.forEach(e=>{this.drawCircle(e)}),this.tick()}},s.initHighScore(),d.onLoad()},window.TheVirus.init=function(){document.getElementById("sound-toggle-button").style.visibility="visible",s.init(m.score);let e=new class{init(){const e=document.getElementById("canvas"),t=document.getElementById("ui-wrapper"),i=window.getComputedStyle(t).height;let s=window.innerWidth;s>1024&&(s=1024);const n=s,o=window.innerHeight-parseFloat(i)-80;e.setAttribute("width",n.toString()),e.setAttribute("height",o.toString()),this.height=e.height,this.width=e.width,this.context=e.getContext("2d"),e.style.borderBottom="solid 80px red",e.style.display="block"}};document.getElementById("controls").style.display="none",document.getElementById("game-over").style.display="none",document.getElementById("game-status").style.display="none",document.getElementById("canvas").style.display="block",document.getElementById("score").innerHTML="0",d.init(),e.init(),m.init(e)}}();